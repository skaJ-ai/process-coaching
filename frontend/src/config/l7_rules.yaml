# L7 Rule Definitions — Minimal POC
# 범위: R-03 / R-05 / R-08 (가장 오탐/운용 이슈가 많은 3개만)
# 다른 규칙(R-01/02/04/15 등)은 l7Rules.ts에 하드코딩 유지
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 단일 소스 원칙 (Single Source of Truth)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 이 파일 = 사람이 읽는 정의 문서 (규칙 의도, 배경 기술)
# rulesLoader.ts = 프론트엔드 런타임 소스 (이 파일의 TS 미러)
#
# 수정 순서:
#   1. 이 YAML 파일을 먼저 수정
#   2. rulesLoader.ts를 YAML과 동일하게 업데이트
#   3. `npm run test:guard` 실행 (sync:check + goldenset)
#   4. 3가지 모두 통과해야 커밋 허용
#
# 검증 명령어:
#   npm run sync:check   → YAML ↔ TS 불일치 감지
#   npm run test:guard   → 전체 게이트 (sync + goldenset)
#
# 보류 규칙: R-04 (정책 미확정), S-04 (별도 Phase)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

rules:
  R-03:
    id: R-03
    name: 구체화 권장
    severity: warning
    description: 모호한 동사 사용 시 경고 (R-03a=reject, R-03b=warning으로 세분화)
    # R-03a: 금지 동사 (어떤 맥락에서도 부적합) — severity: reject
    banned_verbs:
      - 처리한다
      - 진행한다
      - 관리한다
      - 대응한다
      - 지원한다
      - 파악한다
      - 준비한다
      - 고도화한다
      - 리드한다
      - 수행한다
      - 대화한다
      - 진단한다
      - 컨설팅한다
    # R-03b: 구체화 권장 동사 (더 좋은 대안 존재) — severity: warning
    refinable_verbs:
      검토한다: "비교한다, 판정한다, 검증한다"
      개선한다: "수정한다, 재작성한다"
      최적화한다: "수정한다, 재설정한다"
      정리한다: "분류한다, 집계한다, 삭제한다"
      공유한다: "안내한다, 발송한다, 공지한다"
      조율한다: "요청한다, 협의한다"
      협의한다: "요청한다, 회의한다"
      반영한다: "입력한다, 수정한다, 저장한다"
      분석한다: "집계한다, 비교한다, 추출한다"
      평가한다: "판정한다, 검증한다, 비교한다"
      담당한다: "조회한다, 입력한다, 수행하는 구체 동작으로 교체"
      보조한다: "안내한다, 요청한다, 지원 내용의 구체 동작으로 교체"
      피드백한다: "안내한다, 공지한다, 요청한다"
      검수한다: "검증한다, 확인한다, 비교한다"
      상신한다: "제출한다, 요청한다"
      결재한다: "승인한다, 반려한다"
      산출한다: "집계한다, 추출한다"
    message: "'{verb}' 대신 구체 동사를 쓰면 더 명확해질 수 있어요"
    suggestion: "조회한다, 입력한다, 저장한다, 승인한다 같은 동사로 바꿔보세요."

  R-05:
    id: R-05
    name: 복수 동작
    severity: warning
    description: 한 라벨에 동작이 2개 이상 포함된 경우 경고
    # 복수 동작으로 감지할 패턴 (regex string)
    compound_patterns:
      - "(.+?하고),?\\s*(.+?한다)"
      - "(.+?하며),?\\s*(.+?한다)"
      - "(.+?한)\\s+후\\s*(.+?한다)"
      - "(.+?한다),\\s*(.+?한다)"
    # 복수 동작에서 제외할 의도/희망 표현 (먼저 체크)
    intent_exclude_patterns:
      - "하고자\\s*(한다|합니다|했다|했습니다)"
      - "하고\\s*싶다"
      - "하고\\s*싶었다"
    message: "한 라벨에 동작이 2개 이상 포함되어 있어요"
    suggestion: "첫 동작과 다음 동작을 별도 단계로 분리해보세요."

  R-06:
    id: R-06
    name: 주어 누락
    severity: suggestion
    description: 스윔레인 미사용 시, 타동사 + 목적어(을/를) 있으나 주어(이/가/은/는) 없을 때 안내
    condition:
      swim_lane_active: false    # 스윔레인 활성화 시 체크 안 함
      requires_transitive_verb: true
      requires_object_particle: true  # 을/를 있어야 발동
      subject_particle_absent: true   # 이/가/은/는 없을 때
    subject_particle_pattern: "[가-힣\\d][이가은는](\\s|$)"
    message: "주체가 명시되지 않았어요"
    suggestion: "스윔레인으로 역할을 구분하거나, 라벨에 주어를 추가하면 제3자가 이해하기 쉬워집니다."

  R-07:
    id: R-07
    name: 목적어 누락
    severity: reject
    description: 타동사 사용 시 목적어(을/를) 없으면 reject — 최초 가이드라인 '목적어 명확성 필수' 반영
    # TRANSITIVE_VERBS 목록과 동기화 (rulesLoader.ts 참고)
    transitive_verbs:
      - 조회한다
      - 입력한다
      - 수정한다
      - 저장한다
      - 추출한다
      - 비교한다
      - 집계한다
      - 기록한다
      - 첨부한다
      - 판정한다
      - 승인한다
      - 반려한다
      - 전송한다
      - 배포한다
      - 제공한다
      - 체크한다
      - 발송한다
      - 분류한다
    message: "'{verb}'는 타동사인데 목적어(을/를)가 없어요"
    suggestion: "예: '급여를 {verb}' 형태로 대상을 명시해보세요."
    # v2 변경 이력: warning → reject (2026-02-18)
    # 근거: 최초 가이드라인 '목적어 명확성' 필수 항목 복원

  R-08:
    id: R-08
    name: 기준값 누락
    severity: warning
    applies_to:
      - decision
    description: decision 노드에 판단 기준이 드러나지 않을 때 경고
    decision_hints:
      - 여부
      - "?"
      - 인가
      - 인지
      - 이상
      - 이하
      - 초과
      - 미만
      - 승인
      - 반려
      - 가능
      - 불가
    message: "분기 기준이 드러나지 않아 의사결정 조건이 모호할 수 있어요"
    suggestion: "'~여부', '~인가?' 또는 기준값(예: 1억원 초과)을 라벨에 포함해보세요."
