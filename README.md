# Process Coaching AI

L7 기반 HR 프로세스 설계를 위한 시각화 + 코칭 도구입니다.
ReactFlow 캔버스에서 프로세스를 그리고, FastAPI 백엔드의 AI 코칭/검증을 받아 단계 품질을 높이는 것이 목적입니다.

## 핵심 기능

- 플로우 차트 편집
  - 시작/종료/프로세스/판단/L6 프로세스 노드
  - 우클릭 컨텍스트 메뉴, 드래그 연결, 엣지 라벨 편집
- 스윔레인
  - 역할 구분선 ON/OFF
  - 레인 라벨 편집
  - 구분선 드래그/삭제
- L7 검증
  - 노드별 검증 및 배치 검증
  - 이슈 태그, 개선 제안, rewrite 추천
- AI 코칭
  - 플로우 리뷰, 채팅 Q&A, 맥락 제안(contextual suggest)
  - 제안 summary와 실제 라벨(labelSuggestion) 분리 적용
- 품질/운영 보조
  - 자동 저장, 내보내기/가져오기(JSON)
  - PDD 초안 생성

## 기술 스택

- Frontend
  - React 18, TypeScript, Vite 5
  - ReactFlow 11, Zustand
  - TailwindCSS
- Backend
  - FastAPI, Pydantic, httpx

## 빠른 실행

### 1) Backend

```bash
cd backend
pip install -r requirements.txt
py -3 app.py
```

- 기본 포트: `8000`
- 8000 점유 시 코드에서 `8002`로 fallback 실행

### 2) Frontend

```bash
cd frontend
npm install
npm run dev
```

- 기본 주소: `http://127.0.0.1:5173`

## 환경 변수

백엔드 시작 시 아래 파일들을 자동으로 읽습니다(위에서 아래 순서로 확인).

- `backend/.env`
- `backend/environment.txt`
- `.env` (프로젝트 루트)
- `environment.txt` (프로젝트 루트)

권장 방식:

1. `backend/environment.txt.example`를 복사해서 `backend/environment.txt` 생성
2. 주소/모델만 수정
3. 백엔드 재시작

- `LLM_BASE_URL` (default: `http://10.240.248.157:8533/v1`)
- `LLM_MODEL` (default: `Qwen3-Next`)
- `USE_MOCK`
  - `auto`: LLM 연결 확인 후 자동
  - `true`: 항상 mock 응답
  - `false`: 항상 LLM 사용 시도

예시:

```bash
# backend/environment.txt
LLM_BASE_URL=http://10.240.248.157:8533/v1
LLM_MODEL=Qwen3-Next
USE_MOCK=auto
```

참고: 셸에서 같은 키를 이미 설정했다면(`set LLM_BASE_URL=...`) 셸 값이 우선됩니다.

## API 요약

백엔드 주요 엔드포인트:

- `POST /api/chat` : 챗봇 질의/응답
- `POST /api/review` : 플로우 분석 + 제안
- `POST /api/validate-l7` : 노드 L7 검증
- `POST /api/contextual-suggest` : 맥락 기반 한 줄 가이드
- `POST /api/first-shape-welcome` : 첫 노드 추가 시 온보딩 메시지
- `POST /api/analyze-pdd` : PDD 추천 분석
- `GET /api/health` : 상태 점검

## 프로젝트 구조

```text
process-coaching/
  backend/
    app.py                 # FastAPI 진입점 + LLM 프롬프트/검증 로직
    requirements.txt
  frontend/
    src/
      components/          # FlowChart, ChatPanel, Toolbar 등 UI
      store.ts             # 전역 상태/액션(Zustand)
      types.ts             # 도메인 타입
      utils/               # 라벨/레이아웃 유틸
    package.json
```

## 주요 설계 포인트

- 제안 데이터 분리
  - `summary`: 사용자에게 보여줄 설명
  - `labelSuggestion`: 실제 셰이프 라벨
- L7 태그 정합성
  - 백엔드 ruleId와 프론트 friendlyTag 매핑 일치
- 스윔레인 UX
  - 레인 라벨은 좌측 고정 오버레이
  - 드래그 바는 우측 고정 오버레이
  - 드래그 종료(`mouseup`, `buttons===0`) 안정화

## 자주 겪는 문제

- 프론트 실행 시 `spawn EPERM`
  - 보안/샌드박스 환경에서 자식 프로세스 생성이 막힐 때 발생
- PowerShell 실행 정책으로 `npm`/`codex`가 막힘
  - `npm.cmd`, `codex.cmd` 사용
- LLM 연결 지연
  - `USE_MOCK=true`로 프론트 기능/UX 먼저 점검 가능

## 개발 팁

- 커밋 전 확인

```bash
cd frontend
npx tsc --noEmit
```

- `.vite` 캐시는 커밋 대상이 아닙니다.

---

## L7 프로세스 분석 결과 점검 체크리스트

**작성자: AX PM그룹 / 마지막 업데이트: 2026년 2월**

본 체크리스트는 HR 직원이 직접 업무를 **L7 수준으로 Decomposition**할 때, 모든 HR팀이 **동일한 품질**로 작성하도록 돕기 위한 기준이다.

### 원칙

* 필수 항목은 **100% 충족**해야 L7으로 인정
* 이 문장만 보고 다른 사람이 그대로 업무를 수행할 수 있어야 한다
* AS-IS 기준이며 개선/이상/자동화 관점은 포함하지 않는다

---

## 1. 최초 체크리스트 (v1 — 팀 합의 원본)

### 1-1. 구조·형식 (Structure)

| 구분 | 체크리스트 항목 | 상세 내용 | 구분 |
| :--- | :--- | :--- | :--- |
| **구조·형식** | 단일 행동 원칙 | 한 문장에 행동(동사)이 1개만 있다 | 필수 |
| | 목적어 명확성 | 동사의 대상이 명확하다 | 필수 |
| | 지시문 형태 | 설명이 아닌 실행 지시문이다 | 필수 |
| | 문장 독립성 | 앞뒤 문맥 없이 수행 가능하다 | 필수 |
| | L6 반복 금지 | L6(Action)를 그대로 반복하지 않았다 | 필수 |
| **수행 맥락** | 수행 위치 명시 | 시스템/화면/문서/채널이 드러난다 | 필수 |
| | 구체 단위 | 화면/메뉴/탭 단위로 표현했다 | 필수 |
| | 오프라인 표현 | 전화·회의·대면 업무도 명확하다 | 필수 |
| | 시작 조건 | 언제 시작되는지 드러난다 | 권장 |
| | 입력 대상 | 사용하는 데이터/문서가 명확하다 | 필수 |
| | 입력 항목 | 항목 단위로 표현했다 | 필수 |
| | 입력 출처 | 입력 출처가 드러난다 | 권장 |

### 1-2. 판단·의사결정 (Decision)

| 구분 | 체크리스트 항목 | 상세 내용 | 구분 |
| :--- | :--- | :--- | :--- |
| **판단 의사결정** | 판단 포함 여부 | 판단 존재 여부가 명확하다 | 필수 |
| | 판단 기준 | 기준(규정/규칙/조건)이 있다 | 필수 |
| | 판단 결과 | 비교 대상이 명확하다 | 필수 |
| | 분기/반복 | 조건문/루프/IF문 결과가 있다 | 필수 |
| | 판단 기록 보관 | 판단의 기록을 물리적인 결과로 남긴다 | 권장 |

### 1-3. 산출물 및 예외처리 (Output)

| 구분 | 체크리스트 항목 | 상세 내용 | 구분 |
| :--- | :--- | :--- | :--- |
| **산출물 완료 조건** | 산출물 존재 | 결과로 남는 것이 있다 | 필수 |
| | 산출물 형태 | 데이터/파일/상태/화면 등 | 필수 |
| | 저장 위치 | 최종적으로 어디에 위치하는지 명확하다 | 필수 |
| | 완료 기준 | 언제 끝났는지 판단 가능하다 | 필수 |
| **예외 변동성** | 대응 매뉴얼 | 자주 발생하는 예외가 있다 | 권장 |
| | 예외 행동 | 예외 시 행동이 명확하다 | 필수 |
| | 복구 방법 | 재실행/보완 가능성이 있다 | 권장 |
| **표현 품질** | 권장 가능한 동사 | 처리/판단/전달 등 주동사 위주 사용 | 필수 |
| | HR 표준 용어 | HR 표준 용어의 사용 | 권장 |
| | AS-IS 기준 | 개선/제안 표현 없음 | 필수 |

### 1-4. 표준 동사 사전 (v1)

| 카테고리 | 표준 동사 |
| :--- | :--- |
| 데이터/문서 | 조회하다, 입력하다, 수정하다, 저장하다, 전송하다, 비교하다, 집계하다, 기록하다, 첨부한다 |
| 판단 | 포함한다, 승인한다, 반려한다, 결정한다, 체크한다, 확인한다 |
| 커뮤니케이션 | 요청한다, 제공한다, 안내한다, 공지한다, 배포한다, 메일링한다 |

#### L7에서 피해야 할 용어 (v1 — 단일 금지 목록)

> 아래 용어는 활동 목적 기술 선별이나 문맥 분석에 도움이 되지 않으므로 사용하지 않는다.

처리한다, 파악한다, 대응한다, 관리한다 / 지원한다, 보조한다, 담당한다 / 최적화한다, 고도화한다, 리드한다, 대화한다 / 피드백한다, 검토한다, 준비한다, 검수한다 / 상신한다, 결재한다, 공유한다, 컨설팅한다 / 진단한다, 분析한다, 평가한다, 산출한다

### 1-5. Agent 자동 점검 Rule (v1)

#### A. 구조 Rule (Hard Rule)

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-01 | 핵심 동사가 1개인가 | Reject |
| R-02 | 목적어 명사 존재 여부 | Reject |
| R-03 | 금지 동사 포함 여부 | Reject |
| R-04 | 복합 동사 패턴 확인 여부 | Reject |

#### B. 맥락 Rule (Context)

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-05 | 수행 주체 키워드 존재 | Reject |
| R-06 | 위치가 추상적이지 않음 | Reject |
| R-07 | 오프라인 행위 대상 명시 | Warning |

#### C. 입력 출력 Rule

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-08 | 입력 대상 명시 존재 | Reject |
| R-09 | 산출물 명사 존재 | Reject |
| R-10 | 상태 변화 동사 존재 | Reject |
| R-11 | 완료 조건 표현 존재 | Warning |

#### D. 판단 Rule

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-12 | 판단 동사 포함 시 기준 검사 | 기준 검사 |
| R-13 | 판단 기준 키워드 존재 | Reject |
| R-14 | 판단 결과값 키워드 존재 | Reject |

#### E. 표준 동사 Rule (핵심)

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-15 | 표준 동사 목록 포함 | Reject |
| R-16 | 금지 동사 포함 | Reject |
| R-17 | 동사 치환 가능 | Warning |

#### F. 품질 활용 Rule

| Rule ID | Rule 내용 | 처리 |
| :--- | :--- | :--- |
| R-18 | 자동화 가능성 신호 | Score |
| R-19 | 사람 판단 필요성 | Score |
| R-20 | 재작업 가능성 | Score |

---

## 2. 고도화 근거 — v2 설계 이론적 배경

v1은 LLM 프롬프트에 의존하는 부분이 많아 AI 서비스 중단 시 품질 검증이 불가한 구조적 취약점이 있었다. v2는 아래 4개 레퍼런스를 기반으로 **LLM 없이도 70% 커버**할 수 있는 결정론적 구조를 목표로 설계했다.

### 2-1. bpmnlint (Camunda) — 구조 규칙의 산업 표준

Camunda Modeler에 내장된 19개 결정론적 구조 규칙. 모두 O(n) 복잡도로 LLM 없이 즉시 판정 가능하며, 10만 이상의 실사용자 환경에서 검증된 규칙이다.

* 적용 범위: 연결 완결성, 중복 엣지, 판단 노드 형식, 라벨 누락 등
* → v2 S-01~S-11 구조 규칙의 직접 출처

### 2-2. 7PMG (Mendling et al., 2010) — 프로세스 모델 품질 7대 원칙

실제 프로세스 모델 사용자 연구 기반의 학술 원칙. 적용 가능한 3개:

| 원칙 | 내용 | 적용 규칙 |
| :--- | :--- | :--- |
| G2 | 분기 3개 초과 시 이해도 급락 | S-10 과다 분기 경고 |
| G3 | 시작점 2개 이상이면 의도 확인 필요 | S-09 다중 시작 |
| G7 | 노드 50개 초과 모델의 오류율 50% 이상 | S-11 복잡도 경고 |

### 2-3. BEF4LLM (2025) — Rule vs AI 분리 원칙

품질 차원을 4가지로 분류하여 결정론적 처리와 LLM 처리의 경계를 명확히 한다.

| 품질 차원 | 분류 | 처리 방식 |
| :--- | :--- | :--- |
| Validity (구조 완결성) | 결정론적 | S-규칙 (Rule Engine) |
| Syntactic (문법·형식) | 결정론적 | R-규칙 (Rule Engine) |
| Pragmatic (복잡도) | 결정론적 | S-규칙 (Rule Engine) |
| Semantic (의미·맥락) | 확률적 | AI 시그널 A-규칙 (LLM) |

* Rule reject는 AI pass와 관계없이 유지된다
* LLM 미사용 시에도 구조·라벨 검증은 동작한다

### 2-4. Signavio — 4범주 컨벤션

"구조 이상(Structure)"과 "라벨 품질(Label)" 문제를 분리하여 사용자가 개선 우선순위를 파악할 수 있도록 설계.

* → 품질 대시보드에서 S(구조) 규칙과 R(라벨) 규칙을 별도 그룹으로 표시하는 근거

---

## 3. 현행 체크리스트 (v2 — 2026-02-18)

v2는 v1의 라벨 규칙을 계승하면서, **구조 규칙 계층(Tier 1)**과 **AI 분석 계층(Tier 3)**을 추가하여 3계층 구조로 확장했다.

### 3-1. Tier 1 · 구조 규칙 (Structure Rules)

> 결정론적, 즉시 판정 — `frontend/src/utils/structRules.ts`

| Rule ID | Rule 내용 | 수준 | 근거 |
| :--- | :--- | :--- | :--- |
| S-01 | 종료 노드가 최소 1개 있어야 한다 | Warning | bpmnlint |
| S-02 | 기본값("새 태스크") 라벨을 구체화해야 한다 | Warning | bpmnlint |
| S-03 | 연결이 없는 고아 노드가 없어야 한다 | Warning | bpmnlint |
| S-05 | 프로세스 노드에서 직접 분기 시 판단 노드를 사용해야 한다 | Warning | bpmnlint |
| S-06 | 동일한 출발→도착 연결이 중복되면 안 된다 | Warning | bpmnlint |
| S-07 | 판단 노드에서 나가는 경로가 1개만이면 일반 노드로 변경해야 한다 | Warning | bpmnlint |
| S-08 | 판단 노드의 모든 분기에 조건 라벨이 있어야 한다 | Warning | bpmnlint |
| S-09 | 시작 노드가 2개 이상이면 의도적 구조인지 확인해야 한다 | Warning | 7PMG G3 |
| S-10 | 판단 노드에서 4개 이상 분기 시 2단계 판단 구조를 권장한다 | Warning | 7PMG G2 |
| S-11 | 총 노드 50개 초과 시 서브프로세스로 분해를 권장한다 | Warning | 7PMG G7 |

### 3-2. Tier 2 · 라벨 규칙 (Label Rules)

> 결정론적, 즉시 판정 — `frontend/src/utils/l7Rules.ts`

| Rule ID | Rule 내용 | 실패 시 |
| :--- | :--- | :--- |
| R-01 | 라벨이 4자 이상이어야 한다 | Warning |
| R-02 | 라벨이 100자 이하여야 한다 | Warning |
| R-03a | 금지 동사를 포함하지 않아야 한다 (아래 목록 참고) | Reject |
| R-03b | 구체화 권장 동사 사용 시 대안 동사를 안내한다 | Warning |
| R-04 | 괄호/`~에서` 패턴의 시스템명은 메타데이터로 분리해야 한다 | Warning |
| R-05 | 한 라벨에 `~하고/~하며/~한 후` 복수 동작이 없어야 한다 | Reject |
| R-06 | 스윔레인 미사용 시, 타동사+목적어가 있으면 주어를 명시해야 한다 | Suggestion |
| R-07 | 타동사 사용 시 목적어(을/를)가 있어야 한다 | Reject |
| R-08 | 판단 노드에 판단 기준(여부/인가/이상/이하 등)이 드러나야 한다 | Warning |

### 3-3. 동사 정책 상세 (v2)

#### 금지 동사 — R-03a (Reject, 사용 불가)

어떤 맥락에서도 구체적 행위를 나타낼 수 없어 제3자가 수행할 수 없는 동사.

| 동사 | 동사 | 동사 |
| :--- | :--- | :--- |
| 처리한다 | 진행한다 | 관리한다 |
| 대응한다 | 지원한다 | 파악한다 |
| 준비한다 | 고도화한다 | 리드한다 |

#### 구체화 권장 동사 — R-03b (Warning, 대안 제시)

사용 자체는 가능하나 더 구체적인 동사로 교체하면 명확해지는 동사.

| 동사 | 권장 대안 |
| :--- | :--- |
| 검토한다 | 비교한다, 판정한다, 검증한다 |
| 개선한다 | 수정한다, 재작성한다 |
| 정리한다 | 분류한다, 집계한다, 삭제한다 |
| 공유한다 | 안내한다, 발송한다, 공지한다 |
| 조율한다 | 요청한다, 협의한다 |
| 협의한다 | 요청한다, 회의한다 |
| 반영한다 | 입력한다, 수정한다, 저장한다 |
| 분析한다 | 집계한다, 비교한다, 추출한다 |
| 평가한다 | 판정한다, 검증한다, 비교한다 |
| 담당한다 | 조회한다, 입력한다, 구체 동작으로 교체 |
| 보조한다 | 안내한다, 요청한다, 구체 동작으로 교체 |
| 피드백한다 | 안내한다, 공지한다, 요청한다 |
| 최적화한다 | 수정한다, 재설정한다 |

#### 표준 동사 사전 (v2)

| 카테고리 | 표준 동사 |
| :--- | :--- |
| 조회/입력/수정 | 조회한다, 입력한다, 수정한다, 저장한다, 추출한다, 확인한다 |
| 비교/집계/기록 | 비교한다, 집계한다, 기록한다, 첨부한다, 체크한다 |
| 승인/판정/전달 | 판정한다, 승인한다, 반려한다, 결정한다, 전송한다, 배포한다, 제공한다 |
| 요청/안내/공지 | 요청한다, 재요청한다, 안내한다, 공지한다, 에스컬레이션한다 |

### 3-4. Tier 3 · AI 의미 분석 (LLM)

> LLM 사용 가능 시에만 실행. Rule reject는 AI pass와 관계없이 유지된다.

| Rule ID | Rule 내용 | 처리 |
| :--- | :--- | :--- |
| A-01 | 제3자가 라벨만 보고 수행 가능한가 (맥락 충분성) | Score |
| A-02 | 판단 노드 기준이 충분히 구체적인가 | Score |
| A-03 | 플로우에 누락된 단계가 있는가 | Score |
| A-04 | 개선된 라벨 rewrite 제안 | 제안 |
| A-05 | HR 프로세스 도메인 맥락에 맞는가 | Score |
| A-06 | 플로우 전체의 논리적 완결성 | Score |

### 3-5. 점수 체계

**노드 단위 점수 (감점제):**

| 위반 종류 | 감점 |
| :--- | :--- |
| Reject 1개 | -30점 |
| Warning 1개 | -10점 |
| Suggestion 1개 | -3점 |
| 기본 점수 | 100점 (하한 0점) |

**판정 기준:**

| 판정 | 조건 | 표시 |
| :--- | :--- | :--- |
| 재작성 권고 | Reject 있음 | 빨간 테두리 |
| 개선 가능 | Warning만 있음 | 노란 테두리 |
| 기준 준수 | 이슈 없음 | 초록 테두리 |

**플로우 종합 점수 (향후 로드맵):**

```
Flow Quality Score = Structure(30%) + Label(40%) + Semantic(30%)
LLM 미사용 시: Semantic 제외, "미평가" 표시
```

---

## 4. v1 → v2 주요 변경 요약 (팀 토의용)

| 항목 | v1 원본 | v2 현행 | 변경 근거 |
| :--- | :--- | :--- | :--- |
| **구조 계층** | 없음 | S-01~S-11 신설 | bpmnlint / 7PMG — 구조 오류 선제 탐지 |
| **동사 분류 방식** | 금지 단일 목록 (25개+) | 금지 9개 (Reject) + 권장 13개 (Warning) | 현장 오탐 감소 — 절대 금지와 개선 권장을 구분 |
| **확인한다** | 표준 동사 | v2 초기 오분류 → v2.1 표준 복원 | 원본 의도 복원 |
| **공유한다** | 금지 동사 | 구체화 권장 (Warning) | 대안 제시가 금지보다 실무에 유용 |
| **보조한다 / 담당한다** | 금지 동사 | 구체화 권장 (Warning) | 팀 토의 필요 — 지원한다(Reject)와의 일관성 검토 |
| **R-07 목적어 누락** | 필수 (Reject) | v2 초기 Warning → v2.1 Reject 복원 | 원본 "목적어 명확성 필수" 복원 |
| **수행 위치 명시** | 라벨에 포함 필수 | R-04: 메타데이터 필드(systemName)로 분리 | 라벨 간결성 확보, UI에서 별도 관리 |
| **판단 규칙** | R-12→R-13→R-14 3단계 체인 | R-08 단일 규칙 (기준 힌트 키워드) | 3단계 연쇄의 false positive 감소 |
| **R-06 주어 조건** | 없음 | 스윔레인 미사용 시 Suggestion (신규) | 팀 토의 필요 — 현장 적용 반응 확인 |
| **R-18~R-20 품질 활용** | 점수 산정 규칙 | Tier 3 (AI 시그널) 별도 Phase | BEF4LLM — 규칙 점수와 AI 판단 분리 |

### 팀 토의 요청 사항

아래 항목은 현장 적용 전 팀 합의가 필요합니다.

1. **동사 분류 현장 검증** — 금지 9개 / 권장 13개 목록이 실제 HR 작성 패턴과 맞는가? 현장에서 자주 쓰는 동사 중 목록에서 빠진 것이 있는가?
2. **보조한다 / 담당한다 처우** — 원본은 금지였으나 v2에서 Warning으로 완화. 지원한다(Reject)와의 일관성 측면에서 재검토 필요
3. **수행 위치 처리 방식** — 원본 필수 항목이었으나 v2에서 메타데이터로 분리. 라벨 간결성 vs. 수행 위치 명시 우선순위 확인 필요
4. **구조 규칙 승격 여부** — S-01~S-11 중 Warning이 아닌 Reject으로 격상할 규칙이 있는가?
5. **플로우 종합 점수 가중치** — Structure 30% / Label 40% / Semantic 30% 비율이 적절한가?

---

실사용 대상은 HR 프로세스 설계 실무자이며, 목표는 "그리기"가 아니라 "검토 가능한 수준의 프로세스 정의"까지 빠르게 도달하는 것입니다.
